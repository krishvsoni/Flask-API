{% extends 'layout.html' %}

{% block content %}
  <div class="container mx-auto px-4">
    <h2 class="text-2xl font-semibold mb-4">Hey, {{ username }} ðŸ‘‹</h2>

    <div class="bg-white rounded-lg shadow-md p-4 mt-8">
      <h3 class="text-lg font-semibold mb-2">Attendance Calculator</h3>
      <form id="attendanceCalculatorForm" method="post" action="{{ url_for('save_attendance') }}">
        <input type="hidden" name="username" value="{{ username }}">
        <label for="total_lectures">Total Lectures:</label>
        <input type="number" id="totalLectures" name="total_lectures" required min="1">
        <br>
        <label for="attended_lectures">Attended Lectures:</label>
        <input type="number" id="lecturesAttended" name="attended_lectures" required min="0">
        <br>
        <br>
        <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Save Attendance</button>
    </form>
    
      <div id="attendanceResult"></div>
    </div>

    <div class="bg-white rounded-lg shadow-md p-4 mt-8">
      <h3 class="text-lg font-semibold mb-2">Attendance Graph</h3>
      <canvas class="w-full" id="attendanceChart"></canvas>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      document.getElementById('attendanceCalculatorForm').addEventListener('submit', function(event) {
        event.preventDefault();
        var totalLectures = parseFloat(document.getElementById('totalLectures').value);
        var lecturesAttended = parseFloat(document.getElementById('lecturesAttended').value);
        var attendancePercentage = (lecturesAttended / totalLectures) * 100;
        document.getElementById('attendanceResult').innerHTML = "<b> Attendance Percentage: " + attendancePercentage.toFixed(2) + "% </b>";
        updateChart(lecturesAttended, totalLectures - lecturesAttended);
      });

      var ctx = document.getElementById('attendanceChart').getContext('2d');
      var myChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Attended', 'Missed'],
          datasets: [{
            label: 'Attendance',
            data: [0, 0],
            backgroundColor: [
              'rgba(75, 192, 192, 0.2)',
              'rgba(255, 99, 132, 0.2)'
            ],
            borderColor: [
              'rgba(75, 192, 192, 1)',
              'rgba(255, 99, 132, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });

      function updateChart(attended, missed) {
        myChart.data.datasets[0].data = [attended, missed];
        myChart.update();
      }
    });
  </script>
{% endblock %}
